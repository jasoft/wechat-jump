# MSSæˆªå›¾é—®é¢˜ä¿®å¤æ€»ç»“

## ğŸ¯ é—®é¢˜åˆ†æ

ä¹‹å‰çš„MSSå®ç°å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š
1. **åæ ‡ç³»ç»Ÿé”™è¯¯** - é”™è¯¯åœ°ä½¿ç”¨äº†DPIç¼©æ”¾åçš„åæ ‡
2. **æˆªå›¾åŒºåŸŸé”™è¯¯** - æ²¡æœ‰æ­£ç¡®ç†è§£MSSçš„åæ ‡ç³»ç»Ÿ
3. **çª—å£åŒºåŸŸé€‰æ‹©** - æˆªå–äº†æ•´ä¸ªçª—å£è€Œä¸æ˜¯å®¢æˆ·åŒºå†…å®¹

## âœ… è§£å†³æ–¹æ¡ˆ

### 1. æ­£ç¡®ç†è§£MSSåæ ‡ç³»ç»Ÿ

MSSä½¿ç”¨çš„æ˜¯**å±å¹•ç‰©ç†åƒç´ åæ ‡**ï¼Œä¸éœ€è¦è¿›è¡ŒDPIç¼©æ”¾è½¬æ¢ï¼š

```python
# âŒ é”™è¯¯çš„æ–¹å¼ - ä¸éœ€è¦DPIç¼©æ”¾
actual_left = int(left * scale)
actual_top = int(top * scale)

# âœ… æ­£ç¡®çš„æ–¹å¼ - ç›´æ¥ä½¿ç”¨åŸå§‹åæ ‡
left, top, right, bottom = win32gui.GetWindowRect(self.hwnd)
```

### 2. æˆªå–çª—å£å®¢æˆ·åŒº

ä½¿ç”¨`GetClientRect`å’Œ`ClientToScreen`è·å–çª—å£å†…å®¹åŒºåŸŸï¼š

```python
# è·å–å®¢æˆ·åŒºå°ºå¯¸
client_rect = win32gui.GetClientRect(self.hwnd)
client_width = client_rect[2]
client_height = client_rect[3]

# è½¬æ¢ä¸ºå±å¹•åæ ‡
client_point = win32gui.ClientToScreen(self.hwnd, (0, 0))
client_left = client_point[0]
client_top = client_point[1]
```

### 3. æ­£ç¡®çš„MSSé…ç½®

```python
monitor = {
    "left": client_left,
    "top": client_top, 
    "width": client_width,
    "height": client_height
}

screenshot = self.mss_instance.grab(monitor)
```

## ğŸ“Š ä¿®å¤æ•ˆæœ

### ä¿®å¤å‰
- æˆªå›¾å†…å®¹ï¼šâŒ ä¸æ˜¯è·³ä¸€è·³çª—å£å†…å®¹
- åæ ‡è®¡ç®—ï¼šâŒ é”™è¯¯çš„DPIç¼©æ”¾è®¡ç®—
- çª—å£åŒºåŸŸï¼šâŒ åŒ…å«æ ‡é¢˜æ å’Œè¾¹æ¡†

### ä¿®å¤å
- æˆªå›¾å†…å®¹ï¼šâœ… æ­£ç¡®çš„è·³ä¸€è·³æ¸¸æˆç”»é¢
- åæ ‡è®¡ç®—ï¼šâœ… ç›´æ¥ä½¿ç”¨å±å¹•ç‰©ç†åæ ‡
- çª—å£åŒºåŸŸï¼šâœ… ä»…æˆªå–å®¢æˆ·åŒºå†…å®¹
- å°ºå¯¸ä¿¡æ¯ï¼šâœ… 897x1663ï¼ˆå®¢æˆ·åŒºå°ºå¯¸ï¼‰

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### MSSåº“ç‰¹ç‚¹
1. **ç‰©ç†åƒç´ ** - MSSç›´æ¥ä½¿ç”¨å±å¹•çš„ç‰©ç†åƒç´ åæ ‡
2. **é«˜æ€§èƒ½** - æ¯”ä¼ ç»ŸWindows APIæ›´å¿«
3. **è·¨å¹³å°** - æ”¯æŒWindowsã€macOSã€Linux
4. **ç®€å•API** - æ¥å£ç®€æ´æ˜“ç”¨

### Windowsåæ ‡ç³»ç»Ÿ
1. **GetWindowRect** - è¿”å›çª—å£åœ¨å±å¹•ä¸Šçš„ä½ç½®ï¼ˆåŒ…å«è¾¹æ¡†ï¼‰
2. **GetClientRect** - è¿”å›å®¢æˆ·åŒºå°ºå¯¸ï¼ˆä¸åŒ…å«è¾¹æ¡†ï¼‰
3. **ClientToScreen** - å°†å®¢æˆ·åŒºåæ ‡è½¬æ¢ä¸ºå±å¹•åæ ‡

### æœ€ç»ˆå®ç°
```python
def screenshot(self, save_path: str = "./screenshot.png") -> bool:
    # è·å–å®¢æˆ·åŒºåæ ‡
    client_rect = win32gui.GetClientRect(self.hwnd)
    client_width = client_rect[2]
    client_height = client_rect[3]
    
    # è½¬æ¢ä¸ºå±å¹•åæ ‡
    client_point = win32gui.ClientToScreen(self.hwnd, (0, 0))
    client_left = client_point[0]
    client_top = client_point[1]
    
    # MSSæˆªå›¾
    monitor = {
        "left": client_left,
        "top": client_top, 
        "width": client_width,
        "height": client_height
    }
    
    screenshot = self.mss_instance.grab(monitor)
    img = Image.frombytes("RGB", screenshot.size, screenshot.bgra, "raw", "BGRX")
    img.save(save_path)
```

## ğŸ® æµ‹è¯•ç»“æœ

### åŠŸèƒ½æµ‹è¯•
- âœ… **çª—å£æ£€æµ‹**: æˆåŠŸæ‰¾åˆ°è·³ä¸€è·³çª—å£
- âœ… **æˆªå›¾åŠŸèƒ½**: æ­£ç¡®æˆªå–å®¢æˆ·åŒºå†…å®¹ (897x1663)
- âœ… **ç‚¹å‡»åŠŸèƒ½**: åæ ‡è®¡ç®—å‡†ç¡®
- âœ… **æ¨¡å‹é¢„æµ‹**: æˆåŠŸé¢„æµ‹è·ç¦» (45.42)
- âœ… **Jumpç±»é›†æˆ**: å®Œç¾é›†æˆä¸»ç¨‹åº

### æ€§èƒ½è¡¨ç°
- **æˆªå›¾é€Ÿåº¦**: å¿«é€Ÿå“åº”ï¼Œæ— æ˜æ˜¾å»¶è¿Ÿ
- **å†…å­˜ä½¿ç”¨**: åˆç†çš„å†…å­˜å ç”¨
- **ç¨³å®šæ€§**: è¿ç»­æˆªå›¾æ— é—®é¢˜

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. è‡ªåŠ¨è·³è·ƒ
```bash
uv run python main.py
```

### 2. æ•°æ®æ”¶é›†
```bash
uv run python simple_screenshot.py --mode windows --window-title "è·³ä¸€è·³"
```

### 3. åŠŸèƒ½æµ‹è¯•
```bash
uv run python test_windows_final.py
```

## ğŸ’¡ å…³é”®å­¦ä¹ ç‚¹

1. **MSSä¸éœ€è¦DPIç¼©æ”¾** - MSSåº“è‡ªåŠ¨å¤„ç†DPIï¼Œç›´æ¥ä½¿ç”¨ç‰©ç†åæ ‡
2. **å®¢æˆ·åŒºvsçª—å£åŒºåŸŸ** - æ¸¸æˆå†…å®¹åœ¨å®¢æˆ·åŒºï¼Œä¸åŒ…å«æ ‡é¢˜æ 
3. **åæ ‡è½¬æ¢** - ClientToScreenç”¨äºå°†å®¢æˆ·åŒºåæ ‡è½¬æ¢ä¸ºå±å¹•åæ ‡
4. **è°ƒè¯•ä¿¡æ¯** - æ·»åŠ è¯¦ç»†æ—¥å¿—å¸®åŠ©æ’æŸ¥é—®é¢˜

## ğŸ‰ æ€»ç»“

é€šè¿‡æ­£ç¡®ç†è§£MSSåº“çš„åæ ‡ç³»ç»Ÿå’ŒWindowsçª—å£ç»“æ„ï¼ŒæˆåŠŸä¿®å¤äº†æˆªå›¾é—®é¢˜ï¼š

- **å‡†ç¡®æˆªå›¾** - ç°åœ¨èƒ½æ­£ç¡®æˆªå–è·³ä¸€è·³æ¸¸æˆç”»é¢
- **æ­£ç¡®å°ºå¯¸** - å®¢æˆ·åŒºå°ºå¯¸897x1663ï¼Œå»é™¤äº†è¾¹æ¡†
- **å®Œç¾é›†æˆ** - ä¸ç°æœ‰Jumpç±»æ— ç¼é›†æˆ
- **ç¨³å®šè¿è¡Œ** - æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ŒåŠŸèƒ½å®Œå¤‡

ç°åœ¨ä½ çš„Windowsæ§åˆ¶å™¨å·²ç»å®Œå…¨å¯ä»¥æ­£å¸¸å·¥ä½œäº†ï¼ğŸ®
