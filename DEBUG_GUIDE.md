# 跳一跳调试指南

## 🎯 调试功能概述

为了解决跳一跳效果差的问题，我们创建了完整的调试工具套件，包括：

1. **检测框显示** - 可视化显示玩家和平台的检测结果
2. **距离计算** - 精确计算玩家到目标平台的距离
3. **按压时间计算** - 根据距离和系数计算按压时长
4. **详细日志** - 显示每一步的详细信息

## 🔧 调试工具

### 1. 截图分析工具 (`analyze_screenshot.py`)

分析单张截图，显示检测结果和计算信息。

**使用方法：**
```bash
# 分析指定截图
uv run python analyze_screenshot.py --image "./iphone.png"

# 保存分析结果图像
uv run python analyze_screenshot.py --image "./iphone.png" --output "./analysis_result.png"

# 不显示窗口（仅输出文本）
uv run python analyze_screenshot.py --image "./iphone.png" --no-window
```

**输出信息：**
- 检测到的对象数量和类型
- 每个对象的置信度、位置、尺寸
- 玩家和平台的中心点坐标
- 计算出的距离
- 不同系数下的按压时间

### 2. 调试跳跃工具 (`debug_jump.py`)

带有可视化界面的实时调试工具。

**使用方法：**
```bash
# 启动调试模式
uv run python debug_jump.py
```

**功能特性：**
- 实时显示检测框和距离线
- 详细的控制台日志输出
- 可视化调试窗口
- 键盘控制（q退出、s保存、p暂停）

### 3. 快速测试工具 (`test_debug.py`)

快速验证调试功能是否正常工作。

**使用方法：**
```bash
uv run python test_debug.py
```

## 📊 测试结果分析

根据最新的测试结果，我们发现了以下关键信息：

### 检测结果
- ✅ **玩家检测**: 成功检测到玩家 (humen)
- ✅ **平台检测**: 成功检测到多个平台 (cube)
- ✅ **置信度**: 玩家0.932，最佳平台0.969

### 距离计算
- **当前距离**: 75.06像素
- **玩家位置**: (281, 917)
- **目标平台**: (278, 992)
- **距离很短**: 说明目标平台就在玩家附近

### 按压时间
- **计算公式**: 距离 × 系数 = 按压时间
- **当前计算**: 75.06 × 1.18 = 88ms
- **问题分析**: 88ms的按压时间可能太短了！

## 🔍 问题诊断

基于调试结果，跳跃效果差的可能原因：

### 1. 按压时间过短
- **当前**: 88ms
- **建议**: 尝试更大的系数，如2.0-5.0
- **原因**: 距离75像素很短，但可能需要更长的按压时间

### 2. 目标平台选择错误
- **当前**: 选择置信度最高的平台
- **问题**: 可能选择了错误的平台（当前平台而非目标平台）
- **建议**: 选择距离玩家更远的平台

### 3. 坐标系统问题
- **检查**: 点击坐标是否正确映射到游戏窗口
- **验证**: 确认点击位置在游戏区域内

## 🛠️ 调试步骤

### 步骤1: 分析当前截图
```bash
uv run python analyze_screenshot.py --image "./iphone.png" --output "./debug_analysis.png"
```

查看：
- 检测框是否正确标记了玩家和平台
- 距离线是否连接到正确的目标平台
- 计算的距离是否合理

### 步骤2: 调整跳跃系数
在 `main.py` 或 `debug_jump.py` 中尝试不同的系数：

```python
# 当前系数
jump.jump(k=1.18)

# 尝试更大的系数
jump.jump(k=3.0)   # 3倍
jump.jump(k=5.0)   # 5倍
jump.jump(k=10.0)  # 10倍
```

### 步骤3: 改进平台选择逻辑
修改代码选择距离玩家更远的平台：

```python
# 当前：选择置信度最高的平台
# 改进：选择距离玩家最远的平台（排除当前平台）
```

### 步骤4: 实时调试
```bash
uv run python debug_jump.py
```

观察：
- 检测框是否准确
- 距离计算是否合理
- 跳跃效果是否改善

## 📈 优化建议

### 1. 立即尝试的修复

**增加跳跃系数：**
```python
# 在 main.py 中修改
jump.jump(k=5.0)  # 从1.18增加到5.0
```

**原因**: 当前88ms的按压时间明显太短，需要大幅增加。

### 2. 改进平台选择算法

当前代码选择置信度最高的平台，但这可能是玩家当前站立的平台。应该选择：
- 距离玩家一定距离的平台
- 在玩家前方的平台
- 排除玩家脚下的平台

### 3. 添加距离阈值

```python
# 只有距离超过阈值才跳跃
if distance > 50:  # 像素
    # 执行跳跃
else:
    # 距离太近，可能是当前平台
```

## 🎮 快速修复

**立即可以尝试的修改：**

1. **修改 main.py 第90行：**
   ```python
   # 从
   jump.jump(k=1.18)
   # 改为
   jump.jump(k=5.0)
   ```

2. **运行调试模式观察效果：**
   ```bash
   uv run python debug_jump.py
   ```

3. **根据调试结果继续调整系数**

## 📝 调试日志示例

```
🎮 开始新一轮跳跃
📸 正在截图...
✅ 截图成功
🔍 正在分析图像...
📊 检测结果:
   玩家检测: ✓
   平台检测: ✓
   检测数量: 3
   玩家位置: (281, 917)
   平台位置: (278, 992)
   计算距离: 75.06
⏱️ 按压时间计算: 75.06 × 1.18 = 88ms
🖱️ 点击位置: (582, 1188)
⏰ 按压时长: 88ms
✅ 跳跃执行成功
```

这个日志显示一切检测正常，但按压时间可能太短。建议立即尝试增加跳跃系数！
